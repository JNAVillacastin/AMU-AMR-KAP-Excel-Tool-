---
title: "Sample manipulation and analysis of data sheets from the AMU/AMR KAP+ Excel Tools in R"
author: "J.N. Villacastin"
date: "6/16/2020"
output: html_document
---

# Introduction

This short document, we will demonstrate how the **AMU-AMR KAP+ Excel Tools'** design is conducive for data manipulation and analysis in R. Dummy data from the **v2.0-beta versions** are used in this demonstration.

# Data Preparation

An advantage of the AMU-AMR KAP+ Excel Tools is that you have the choice to analyze the data in its raw form, coded form, and/or processed/cleaned form. As we will see in the following examples, it is advantageous to analyze the data in different levels depending on the research questions you want to pursue. 

R is a very powerful programming language designed for statistics and data science. The following R packages used are part of the **tidyverse** collection of packages suited for data science.  

```{r}
#install.packages("tidyverse")

library(readr)
library(dplyr)
library(ggplot2)

```

## Importing the .csv files

### Creating .csv files from the Excel tools

Before using the data in the Excel tool, it has to be imported into a .csv file. .csv files are versatile as they can be used in other programming languages and statistical software such as SPSS. 

To create a .csv file, we advise that you copy the specific columns you want to analyze into a separate Excel file and save it as a .csv file. 

### Importing and manipulating the .csv file 

To import the file on R, you may use the **read_csv** function and paste the location of the .csv file in your computer. The .csv file we will be using in this example, sample_vendor.csv, can be found in the GitHub repository. 

```{r}
#importing a .csv file to R

sample_vendor <- read_csv("C:/Users/user/Desktop/Presentation/sample_vendor.csv")
head(sample_vendor) #notice how each variable has four different arrays for score, ratio, index, and quartile
```

Notice how in the **processed_data** sheet, each variable has four different arrays: score, ratio, index, and quartile. Depending on your analysis, you may want to select only one type of these arrays. The **dplyr** package makes it possible to create a new dataframe containing only one type of array. In this example, we will create a dataframe for variable scores only called **vendor_scores**

The reason for the variable naming convention (i.e. kab_score) is to maximize the **dplyr** package's ability to select variables based on their first or last phrase using the **select** function. For example, if you want to create a data frame with only the **score columns** you can use the following code:

```{r}
#To isolate columns containing sample scores into a new dataframe "vendor_scores" 

vendor_scores <- select(sample_vendor, ends_with("score"))
head(vendor_scores)
```

# Data Analysis

The Excel tool is not meant for more advanced methods of analyzing data. In R, it only takes a few lines of code to execute such methods. 

For example, with our **vendor_scores** data frame, we can execute a chi-square test with a single line:

```{r}
#checking for chi-square

chisq.test(vendor_scores)
  
```

Regression is also very easy in R. For example, imagine we want to model the regression of selling practices and all the knowledge variables. This can be done with the following code:

```{r}
#regression example with selling practices and knowledge variables
#the syntax for regression in R is lm(x ~ y) 
#in this case, selling practices ~ knowledge variables

model1 <- lm(psp_score ~ kab_score + kabr_score + kam_score + kamr_score, vendor_scores)
summary(model1)

```

We can plot our regression model be simply typing **plot(name of model)**

```{r}
#plotting the regression model

plot(model1)
```

## Combining raw_data and processed_data sheets for further analysis

In your analysis, you may want to compare how scores differ among demographic categories. You can do this by merging data from the raw_data sheet (imported as .csv) with the existing scores data sheet. In this example, we will merge **vendor_demographics.csv** (also in the GitHub repository) with our existing dataframe, **vendor_scores** to create a new dataframe, **vendor_data**.

```{r}
#importing vendor_demographics.csv

vendor_demographics <- read_csv("C:/Users/user/Desktop/Presentation/vendor_demographics.csv")
head(vendor_demographics)
```

to merge vendor_demographics and vendor_scores, first create a *key column* that links both dataframes. In this example, we will create an ID no. column as our key column.

```{r}
#Generating an ID column

demo_id <- tibble::rowid_to_column(vendor_demographics, "ID")
head(demo_id)

score_id <- tibble::rowid_to_column(vendor_scores, "ID")
head(score_id)

```

Once the key column has been generated, you can now merge both dataframes.In this example, we will merge both dataframes by "ID" key column into a new dataframe, **vendor_data**

```{r}
#merge dataframes by "ID"

vendor_data <- merge(x = demo_id, y = score_id, by = "ID", all = TRUE)
head(vendor_data)
```


## Analyzing combined raw_data and processed_data dataframes

The **vendor_data** dataframe allows us to analyze how different variable scores differ among demographic categories. For example, we can plot the difference of knowledge scores among vendor professions with the following:

```{r}
#plotting the difference of knowledge scores among vendor professions

ggplot(vendor_data, aes(d2_profession, kab_score + kabr_score + kam_score + kamr_score)) +
  geom_boxplot() +
  labs(title = "Knowledge Scores by Profession", x = "Profession", y = "knowledge scores")


```

It is also possible to graph the scores of different categories. Take the following example: you want to visually represent the relationship between "Knowledge" scores and "Practices" scores of vendors of different years of work experience. R makes this very easy with the **ggplot2** library:

```{r}
#plotting the relationship between knolwedge scores and practices scores by work experience

ggplot(vendor_data, aes(kab_score + kabr_score + kam_score + kamr_score, psp_score + pas_score + pac_score + 
  pr_score + pd_score + ps_score + pim_score, color = d4_workexp)) +
  geom_line() +
  labs(title = "Relationship between Knowledge Scores and Practices Scores by Work Experience", 
       x = "Knowledge Score", 
       y = "Practices Score")
```








